<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜åº¦ãªéŸ³å£°èªè­˜ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f8ff; }
        .container { max-width: 900px; margin: 0 auto; }
        .card { background: white; padding: 20px; margin: 15px 0; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .button { padding: 15px 25px; margin: 8px; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .primary { background: #4CAF50; color: white; }
        .primary:hover { background: #45a049; }
        .danger { background: #f44336; color: white; }
        .danger:hover { background: #da190b; }
        .warning { background: #ff9800; color: white; }
        .warning:hover { background: #e68900; }
        
        .status { padding: 20px; margin: 15px 0; border-radius: 8px; font-weight: bold; font-size: 16px; }
        .status.success { background: #d4edda; color: #155724; border: 2px solid #c3e6cb; }
        .status.info { background: #cce7ff; color: #004085; border: 2px solid #99d6ff; }
        .status.warning { background: #fff3cd; color: #856404; border: 2px solid #ffe69c; }
        .status.error { background: #f8d7da; color: #721c24; border: 2px solid #f5c2c7; }
        
        .transcript-box {
            background: #f8f9fa;
            border: 3px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            min-height: 120px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            margin: 15px 0;
        }
        
        .final-text { color: #28a745; font-weight: bold; font-size: 18px; }
        .interim-text { color: #6c757d; font-style: italic; }
        .confidence-text { color: #007bff; font-size: 14px; }
        
        .log-container {
            background: #1a1a1a;
            color: #00ff41;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            border-radius: 8px;
            margin: 15px 0;
            white-space: pre-wrap;
        }

        .config-panel {
            background: #e8f4f8;
            border: 2px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .config-row {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .config-row label {
            width: 200px;
            font-weight: bold;
        }

        .config-row select, .config-row input {
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        .timer {
            font-size: 24px;
            font-weight: bold;
            color: #dc3545;
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ é«˜åº¦ãªéŸ³å£°èªè­˜ãƒ†ã‚¹ãƒˆ</h1>
        <p><strong>éŸ³å£°ã¯æ¤œå‡ºã•ã‚Œã‚‹ãŒãƒ†ã‚­ã‚¹ãƒˆåŒ–ã•ã‚Œãªã„å•é¡Œ</strong>ã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®ç‰¹åˆ¥ãªãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã§ã™ã€‚</p>
        
        <!-- è¨­å®šãƒ‘ãƒãƒ« -->
        <div class="card">
            <h3>âš™ï¸ éŸ³å£°èªè­˜è¨­å®š</h3>
            <div class="config-panel">
                <div class="config-row">
                    <label>èªè­˜æ™‚é–“:</label>
                    <select id="durationSelect">
                        <option value="10">10ç§’</option>
                        <option value="20" selected>20ç§’</option>
                        <option value="30">30ç§’</option>
                        <option value="60">60ç§’</option>
                    </select>
                </div>
                <div class="config-row">
                    <label>è¨€èªè¨­å®š:</label>
                    <select id="langSelect">
                        <option value="ja-JP" selected>æ—¥æœ¬èª</option>
                        <option value="en-US">è‹±èª</option>
                        <option value="ja">æ—¥æœ¬èª(çŸ­ç¸®)</option>
                    </select>
                </div>
                <div class="config-row">
                    <label>ç¶™ç¶šãƒ¢ãƒ¼ãƒ‰:</label>
                    <select id="continuousSelect">
                        <option value="true" selected>æœ‰åŠ¹ (æ¨å¥¨)</option>
                        <option value="false">ç„¡åŠ¹</option>
                    </select>
                </div>
                <div class="config-row">
                    <label>ä¸­é–“çµæœ:</label>
                    <select id="interimSelect">
                        <option value="true" selected>æœ‰åŠ¹ (æ¨å¥¨)</option>
                        <option value="false">ç„¡åŠ¹</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ -->
        <div class="card">
            <h3>ğŸ¤ é•·æ™‚é–“éŸ³å£°èªè­˜ãƒ†ã‚¹ãƒˆ</h3>
            <div id="timer" class="timer">å¾…æ©Ÿä¸­</div>
            
            <div style="text-align: center;">
                <button id="startBtn" class="button primary">ğŸš€ é•·æ™‚é–“éŸ³å£°èªè­˜é–‹å§‹</button>
                <button id="stopBtn" class="button danger" disabled>â¹ï¸ åœæ­¢</button>
                <button id="resetBtn" class="button warning">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
            
            <div id="status" class="status info">
                ãƒ†ã‚¹ãƒˆå‰ã®çŠ¶æ…‹ã§ã™ã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ã€Œé•·æ™‚é–“éŸ³å£°èªè­˜é–‹å§‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
            </div>

            <h4>ğŸ“ éŸ³å£°èªè­˜çµæœ:</h4>
            <div id="transcript" class="transcript-box">
                ã“ã“ã«éŸ³å£°èªè­˜ã®çµæœãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br>
                <strong>ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ã‚º:</strong> ã€ŒãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€ã€Œä»Šæ—¥ã¯ã„ã„å¤©æ°—ã§ã™ã­ã€ã€ŒéŸ³å£°èªè­˜ã®ãƒ†ã‚¹ãƒˆã‚’ã—ã¦ã„ã¾ã™ã€
            </div>
        </div>

        <!-- çµ±è¨ˆæƒ…å ± -->
        <div class="card">
            <h3>ğŸ“Š èªè­˜çµ±è¨ˆ</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                <div style="text-align: center; padding: 10px; background: #e8f5e9; border-radius: 8px;">
                    <div id="totalWords" style="font-size: 24px; font-weight: bold; color: #2e7d32;">0</div>
                    <div>èªè­˜å˜èªæ•°</div>
                </div>
                <div style="text-align: center; padding: 10px; background: #e3f2fd; border-radius: 8px;">
                    <div id="avgConfidence" style="font-size: 24px; font-weight: bold; color: #1976d2;">0%</div>
                    <div>å¹³å‡ä¿¡é ¼åº¦</div>
                </div>
                <div style="text-align: center; padding: 10px; background: #fff3e0; border-radius: 8px;">
                    <div id="resultCount" style="font-size: 24px; font-weight: bold; color: #f57c00;">0</div>
                    <div>çµæœå—ä¿¡å›æ•°</div>
                </div>
                <div style="text-align: center; padding: 10px; background: #fce4ec; border-radius: 8px;">
                    <div id="elapsedTime" style="font-size: 24px; font-weight: bold; color: #c2185b;">0s</div>
                    <div>çµŒéæ™‚é–“</div>
                </div>
            </div>
        </div>

        <!-- è©³ç´°ãƒ­ã‚° -->
        <div class="card">
            <h3>ğŸ” è©³ç´°ãƒ­ã‚°</h3>
            <div style="text-align: center; margin-bottom: 10px;">
                <button onclick="clearLog()" class="button warning">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
                <button onclick="downloadLog()" class="button primary">ãƒ­ã‚°ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
            </div>
            <div id="log" class="log-container">ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å®Œäº†...\n</div>
        </div>
    </div>

    <script>
        class AdvancedVoiceTest {
            constructor() {
                this.recognition = null;
                this.isRunning = false;
                this.startTime = null;
                this.timer = null;
                this.timeoutId = null;
                
                this.stats = {
                    totalWords: 0,
                    totalConfidence: 0,
                    resultCount: 0,
                    finalResults: []
                };
                
                this.setupEventListeners();
                this.log('é«˜åº¦ãªéŸ³å£°èªè­˜ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«åˆæœŸåŒ–å®Œäº†');
            }

            setupEventListeners() {
                document.getElementById('startBtn').onclick = () => this.startRecognition();
                document.getElementById('stopBtn').onclick = () => this.stopRecognition();
                document.getElementById('resetBtn').onclick = () => this.resetTest();
            }

            log(message, type = 'info') {
                const timestamp = new Date().toISOString().substring(11, 23);
                const logContainer = document.getElementById('log');
                const color = {
                    'info': '#00ff41',
                    'success': '#00ff00',
                    'warning': '#ffff00',
                    'error': '#ff4444'
                }[type] || '#00ff41';
                
                logContainer.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span>\n`;
                logContainer.scrollTop = logContainer.scrollHeight;
                console.log(`[${type}] ${message}`);
            }

            updateStatus(message, statusClass) {
                const statusEl = document.getElementById('status');
                statusEl.textContent = message;
                statusEl.className = `status ${statusClass}`;
            }

            updateTimer(remainingTime) {
                const timerEl = document.getElementById('timer');
                if (remainingTime > 0) {
                    timerEl.textContent = `æ®‹ã‚Š ${remainingTime}ç§’`;
                    timerEl.style.color = remainingTime <= 10 ? '#dc3545' : '#28a745';
                } else {
                    timerEl.textContent = 'å®Œäº†';
                    timerEl.style.color = '#6c757d';
                }
            }

            updateStats() {
                document.getElementById('totalWords').textContent = this.stats.totalWords;
                document.getElementById('avgConfidence').textContent = 
                    this.stats.resultCount > 0 ? 
                    Math.round((this.stats.totalConfidence / this.stats.resultCount) * 100) + '%' : '0%';
                document.getElementById('resultCount').textContent = this.stats.resultCount;
                
                if (this.startTime) {
                    const elapsed = Math.floor((Date.now() - this.startTime) / 1000);
                    document.getElementById('elapsedTime').textContent = elapsed + 's';
                }
            }

            async startRecognition() {
                this.log('=== é•·æ™‚é–“éŸ³å£°èªè­˜ãƒ†ã‚¹ãƒˆé–‹å§‹ ===', 'success');

                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    this.log('éŸ³å£°èªè­˜APIãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'error');
                    this.updateStatus('ã‚¨ãƒ©ãƒ¼: ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“', 'error');
                    return;
                }

                try {
                    // è¨­å®šã‚’å–å¾—
                    const duration = parseInt(document.getElementById('durationSelect').value);
                    const lang = document.getElementById('langSelect').value;
                    const continuous = document.getElementById('continuousSelect').value === 'true';
                    const interimResults = document.getElementById('interimSelect').value === 'true';

                    this.log(`è¨­å®š: æ™‚é–“=${duration}ç§’, è¨€èª=${lang}, ç¶™ç¶š=${continuous}, ä¸­é–“çµæœ=${interimResults}`);

                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    
                    // è¨­å®šã‚’é©ç”¨
                    this.recognition.continuous = continuous;
                    this.recognition.interimResults = interimResults;
                    this.recognition.lang = lang;
                    
                    // ã‚ˆã‚Šç©æ¥µçš„ãªè¨­å®š
                    if ('maxAlternatives' in this.recognition) {
                        this.recognition.maxAlternatives = 3;  // ä»£æ›¿æ¡ˆã‚’å¢—ã‚„ã™
                        this.log('maxAlternatives = 3 ã«è¨­å®š');
                    }

                    // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¨­å®š
                    this.setupRecognitionEvents();

                    this.isRunning = true;
                    this.startTime = Date.now();
                    this.stats = { totalWords: 0, totalConfidence: 0, resultCount: 0, finalResults: [] };

                    // UIæ›´æ–°
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('stopBtn').disabled = false;
                    document.getElementById('transcript').innerHTML = '<div style="color: #007bff;">éŸ³å£°èªè­˜æº–å‚™ä¸­...</div>';

                    // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
                    let remainingTime = duration;
                    this.updateTimer(remainingTime);
                    
                    this.timer = setInterval(() => {
                        remainingTime--;
                        this.updateTimer(remainingTime);
                        this.updateStats();
                        
                        if (remainingTime <= 0) {
                            this.log('è¨­å®šæ™‚é–“ã«åˆ°é”ã—ã¾ã—ãŸ', 'warning');
                            this.stopRecognition();
                        }
                    }, 1000);

                    // éŸ³å£°èªè­˜é–‹å§‹
                    this.log('éŸ³å£°èªè­˜ã‚’é–‹å§‹ã—ã¾ã™...', 'success');
                    this.recognition.start();

                    this.updateStatus('éŸ³å£°èªè­˜å®Ÿè¡Œä¸­... æ˜ç­ã«è©±ã—ç¶šã‘ã¦ãã ã•ã„ã€‚', 'info');

                } catch (error) {
                    this.log(`éŸ³å£°èªè­˜é–‹å§‹ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    this.updateStatus(`é–‹å§‹ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    this.resetTest();
                }
            }

            setupRecognitionEvents() {
                this.recognition.onstart = () => {
                    this.log('ğŸ¤ éŸ³å£°èªè­˜ãŒæ­£å¸¸ã«é–‹å§‹ã•ã‚Œã¾ã—ãŸ', 'success');
                    this.updateStatus('éŸ³å£°èªè­˜ä¸­... è©±ã—ç¶šã‘ã¦ãã ã•ã„', 'success');
                };

                this.recognition.onaudiostart = () => {
                    this.log('ğŸµ ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå…¥åŠ›é–‹å§‹', 'info');
                };

                this.recognition.onsoundstart = () => {
                    this.log('ğŸ”Š éŸ³å£°æ¤œå‡ºé–‹å§‹', 'success');
                };

                this.recognition.onspeechstart = () => {
                    this.log('ğŸ‘„ ç™ºè©±æ¤œå‡ºé–‹å§‹', 'success');
                };

                this.recognition.onspeechend = () => {
                    this.log('ğŸ‘„ ç™ºè©±æ¤œå‡ºçµ‚äº†', 'info');
                };

                this.recognition.onsoundend = () => {
                    this.log('ğŸ”‡ éŸ³å£°æ¤œå‡ºçµ‚äº†', 'info');
                };

                this.recognition.onaudioend = () => {
                    this.log('ğŸµ ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå…¥åŠ›çµ‚äº†', 'info');
                };

                this.recognition.onresult = (event) => {
                    this.handleResult(event);
                };

                this.recognition.onerror = (event) => {
                    this.log(`âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: ${event.error}`, 'error');
                    
                    switch(event.error) {
                        case 'no-speech':
                            this.log('éŸ³å£°ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ã‚‚ã†ä¸€åº¦è©±ã—ã¦ãã ã•ã„ã€‚', 'warning');
                            // no-speechã§ã¯åœæ­¢ã›ãšã€ç¶™ç¶šã™ã‚‹
                            break;
                        case 'audio-capture':
                            this.log('ãƒã‚¤ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼ã€‚ãƒã‚¤ã‚¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚', 'error');
                            this.updateStatus('ãƒã‚¤ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼', 'error');
                            break;
                        case 'not-allowed':
                            this.log('ãƒã‚¤ã‚¯è¨±å¯ãŒæ‹’å¦ã•ã‚Œã¦ã„ã¾ã™ã€‚', 'error');
                            this.updateStatus('ãƒã‚¤ã‚¯è¨±å¯ã‚¨ãƒ©ãƒ¼', 'error');
                            break;
                        default:
                            this.log(`äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: ${event.error}`, 'error');
                    }
                };

                this.recognition.onend = () => {
                    this.log('ğŸ”š éŸ³å£°èªè­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†', 'warning');
                    
                    // ç¶™ç¶šãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã§ã€ã¾ã å®Ÿè¡Œä¸­ã®å ´åˆã¯å†é–‹
                    if (this.isRunning && this.recognition.continuous) {
                        this.log('ç¶™ç¶šãƒ¢ãƒ¼ãƒ‰ã§å†é–‹ã—ã¾ã™...', 'info');
                        setTimeout(() => {
                            try {
                                if (this.isRunning) {
                                    this.recognition.start();
                                }
                            } catch (error) {
                                this.log(`å†é–‹ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                            }
                        }, 100);
                    }
                };
            }

            handleResult(event) {
                this.log(`ğŸ“ éŸ³å£°èªè­˜çµæœå—ä¿¡ (results: ${event.results.length})`, 'success');
                this.stats.resultCount++;

                let finalTranscript = '';
                let interimTranscript = '';
                let confidenceSum = 0;
                let confidenceCount = 0;

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const result = event.results[i];
                    const transcript = result[0].transcript;
                    const confidence = result[0].confidence;

                    this.log(`çµæœ ${i}: "${transcript}" (ä¿¡é ¼åº¦: ${confidence ? (confidence * 100).toFixed(1) + '%' : 'N/A'}, ç¢ºå®š: ${result.isFinal})`);

                    if (result.isFinal) {
                        finalTranscript += transcript + ' ';
                        this.stats.finalResults.push({
                            text: transcript,
                            confidence: confidence,
                            timestamp: new Date()
                        });
                        
                        // å˜èªæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
                        const words = transcript.trim().split(/\s+/).length;
                        this.stats.totalWords += words;
                        this.log(`ç¢ºå®šçµæœè¿½åŠ : "${transcript}" (${words}èª)`, 'success');
                    } else {
                        interimTranscript += transcript;
                    }

                    if (confidence) {
                        confidenceSum += confidence;
                        confidenceCount++;
                    }
                }

                // ä¿¡é ¼åº¦ã®å¹³å‡ã‚’æ›´æ–°
                if (confidenceCount > 0) {
                    this.stats.totalConfidence = (this.stats.totalConfidence * (this.stats.resultCount - 1) + confidenceSum / confidenceCount) / this.stats.resultCount;
                }

                // çµæœã‚’è¡¨ç¤º
                this.displayResults(finalTranscript, interimTranscript);
                this.updateStats();

                // æˆåŠŸã®å ´åˆã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
                if (finalTranscript.trim()) {
                    this.updateStatus('âœ… éŸ³å£°èªè­˜æˆåŠŸï¼ãƒ†ã‚­ã‚¹ãƒˆãŒèªè­˜ã•ã‚Œã¦ã„ã¾ã™', 'success');
                }
            }

            displayResults(finalText, interimText) {
                const transcriptEl = document.getElementById('transcript');
                
                let html = '';
                if (this.stats.finalResults.length > 0) {
                    html += '<div class="final-text">ç¢ºå®šçµæœ:</div>';
                    this.stats.finalResults.forEach((result, index) => {
                        const confidence = result.confidence ? ` (${(result.confidence * 100).toFixed(1)}%)` : '';
                        html += `<div class="final-text">${index + 1}. ${result.text}${confidence}</div>`;
                    });
                }
                
                if (interimText) {
                    html += '<div style="margin-top: 10px;" class="interim-text">èªè­˜ä¸­: ' + interimText + '</div>';
                }
                
                if (!html) {
                    html = '<div style="color: #666;">éŸ³å£°èªè­˜å¾…æ©Ÿä¸­... ç¶™ç¶šã—ã¦è©±ã—ã¦ãã ã•ã„</div>';
                }
                
                transcriptEl.innerHTML = html;
            }

            stopRecognition() {
                this.log('éŸ³å£°èªè­˜ã‚’åœæ­¢ã—ã¾ã™', 'warning');
                this.isRunning = false;
                
                if (this.recognition) {
                    this.recognition.stop();
                }
                
                if (this.timer) {
                    clearInterval(this.timer);
                    this.timer = null;
                }
                
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
                
                this.updateTimer(0);
                
                // æœ€çµ‚çµæœã®è©•ä¾¡
                if (this.stats.finalResults.length > 0) {
                    this.log(`âœ… ãƒ†ã‚¹ãƒˆå®Œäº†ï¼ ${this.stats.finalResults.length}ä»¶ã®çµæœã‚’å–å¾—ã—ã¾ã—ãŸ`, 'success');
                    this.updateStatus(`ãƒ†ã‚¹ãƒˆå®Œäº†: ${this.stats.totalWords}èªã‚’èªè­˜ã—ã¾ã—ãŸ`, 'success');
                } else {
                    this.log('âš ï¸ ãƒ†ã‚¹ãƒˆå®Œäº†ã—ã¾ã—ãŸãŒã€æœ€çµ‚çš„ãªãƒ†ã‚­ã‚¹ãƒˆçµæœã¯å¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸ', 'warning');
                    this.updateStatus('ãƒ†ã‚¹ãƒˆå®Œäº†: éŸ³å£°ã¯æ¤œå‡ºã•ã‚Œã¾ã—ãŸãŒã€ãƒ†ã‚­ã‚¹ãƒˆåŒ–ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ', 'warning');
                }
            }

            resetTest() {
                this.stopRecognition();
                this.stats = { totalWords: 0, totalConfidence: 0, resultCount: 0, finalResults: [] };
                this.updateStats();
                document.getElementById('transcript').innerHTML = 'éŸ³å£°èªè­˜çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚';
                this.updateStatus('ãƒªã‚»ãƒƒãƒˆå®Œäº†ã€‚è¨­å®šã‚’ç¢ºèªã—ã¦å†åº¦ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚', 'info');
                this.log('ãƒ†ã‚¹ãƒˆãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸ', 'info');
            }
        }

        function clearLog() {
            document.getElementById('log').innerHTML = 'ãƒ­ã‚°ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ...\n';
        }

        function downloadLog() {
            const logContent = document.getElementById('log').textContent;
            const blob = new Blob([logContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `voice-test-log-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // åˆæœŸåŒ–
        window.onload = () => {
            new AdvancedVoiceTest();
        };
    </script>
</body>
</html>